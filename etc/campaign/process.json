[
    {
        "$class": "redis",
        "$method": "getHash",
        "key": "{$message}",
        "$set": "campaignHash"
    },
    {
        "$class": "message",
        "$method": "as_campaign",
        "id": "{$message}",
        "data": "{$campaignHash}",
        "$set": "campaign"
    },
    {
        "$class": "couch",
        "id": "{$campaign.id}",
        "doc": "{$campaign}",
        "$set": "logResp"
    },
    {
        "$class": "message",
        "$method": "attach_body",
        "message": "{$campaign}",
        "$set": "msg"
    },
    {
        "if": "{$campaign.id}",
        "$class": "job",
        "name": "authorize-msg",
        "data": "{$campaign}",
        "$set": "auth"
    },
    {
        "if": "{$auth.success}",
        "$class": "job",
        "name": "campaign-run",
        "data": "{$campaign.id}",
        "$set": "jobResult"
    },
    {
        "if": "{$auth.success}",
        "$class": "redis",
        "$method": "setValue",
        "key": "{$message}",
        "property": "status",
        "value": "Queued"
    },
    {
        "if": "{$auth.success}",
        "$class": "redis",
        "$method": "publish",
        "channel": "opxi2.campaign.change.{$message}",
        "message": "{$message}"
    },
    {
        "if": "{$jobResult}",
        "$function": "console.print",
        "$args": [ "Campaign-Run Job's result: ", "{$jobResult}"]
    }
]