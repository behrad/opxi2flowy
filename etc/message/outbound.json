[
    {
        "$class": "uuid",
        "$set": "msg_uuid"
    },
    {
        "$class": "message",
        "id": "{$msg_uuid}",
        "data": "{$job.data}",
        "$set": "msgObj"
    },
    {
        "$class": "message",
        "$method": "attach_body",
        "message": "{$msgObj}",
        "$set": "msg"
    },
    {
        "$class": "couch",
        "id": "{$msg_uuid}",
        "doc": "{$msg}",
        "$set": "logResp"
    },
    {
        "$function": "console.print",
        "$args": [ "Outbound Msg Request: ", "{$logResp}" ]
    },
    {
        "$class": "job",
        "name": "send-{$msg.channel}",
        "blocking": true,
        "data": "{$msg}",
        "$set": "msg_send_response"
    },
    {
        "if": "{$msg_send_response}",
        "$class": "message",
        "$method": "as_log",
        "action": "sending",
        "log": "{$msg_send_response}",
        "$set": "logJson"
    },
    {
        "if": "{$logJson}",
        "$class": "couch",
        "$method": "update",
        "id": "{$msg_uuid}",
        "data": "{$logJson}"
    },
    {
        "if": "{$msg_send_response}",
        "$class": "redis",
        "$method": "publish",
        "channel": "opxi2.outbound.sent.{$msg_uuid}",
        "message": "{$msg}"
    }
]