[
    {
        "$class": "atm_event",
        "$method": "process",
        "event": "{$change.doc}",
        "$set": "failure"
    },
    {
        "if": "{$failure.new}",
        "$class": "crm",
        "$method": "event_matches",
        "label": "alarmtime",
        "$set": "in_time",
        "$empty": "no_alarm"
    },
    {
        "if": "{$no_alarm}",
        "$class": "atm_event",
        "$method": "process",
        "eventId": "{$failure.id}",
        "$set": "fixed",
        "$empty": "not_fixed"
    },
    {
        "if": "{$in_time}",
        "$class": "wait",
        "secs": "{$failure.alarm.postpone}",
        "$set": "ready_to_alarm"
    },
    {
        "if": "{$ready_to_alarm}",
        "$class": "atm_event",
        "$method": "check",
        "eventId": "{$failure.id}",
        "$set": "fixed",
        "$empty": "not_fixed"
    },
    {
        "if": "{$not_fixed}",
        "$class": "job",
        "name": "atm_failure_notify",
        "blocking": true,
        "$retires": "{$failure.alarm.retries}",
        "$priority": "high",
        "data": "{$failure}",
        "$set": "notifications_finished"
    },
    {
        "if": "{$notifications_finished}",
        "$class": "atm_event",
        "$method": "check",
        "eventId": "{$failure.id}",
        "$set": "fixed_now",
        "$empty": "still_not_fixed"
    },
    {
        "if": "{$still_not_fixed}",
        "$class": "atm_event",
        "$method": "markFailure",
        "eventId": "{$failure.id}"
    },
    {
        "if": "[$still_not_fixed]",
        "$class": "job",
        "name": "atm_supervisor_notify",
        "data": "{$failure.id}"
    }
]