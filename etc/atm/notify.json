[
    {
        "$class": "atm_event",
        "$method": "update",
        "eventId": "{$job.data.id}",
        "state":"alarm started",
        "status": "alarm started"
    },
    {
        "$class": "job",
        "name": "atm_failure_alarm",
        "blocking": true,
        "data": "{$job.data}",
        "$set": "alarm",
        "$empty": "alarm_failed"
    },
    {
        "if": "{$alarm.error}",
        "$class": "atm_event",
        "$method": "update",
        "eventId":"{$job.data.id}",
        "status":"alarm not answered",
        "state":"{$alarm.message}"
    },
    {
        "if": "{$alarm_failed}",
        "$class": "atm_event",
        "$method": "update",
        "eventId": "{$job.data.id}",
        "status": "Alarm failed"
    },
    {
        "if": "{$alarm.answered}",
        "$class": "atm_event",
        "$method": "update",
        "eventId": "{$job.data.id}",
        "state":"alarm answered, waiting for fix",
        "status": "alarm answered, waiting for fix"
    },
    {
        "if": "{$alarm.answered}",
        "$class": "wait",
        "secs": "{$job.data.alarm.between_try_delay}",
        "$set": "ready_next_notify"
    },
    {
        "if": "{$alarm.error}",
        "$class": "wait",
        "secs": 0,
        "$set": "ready_next_notify"
    },
    {
        "if": "{$alarm_failed}",
        "$class": "wait",
        "secs": 0,
        "$set": "ready_next_notify"
    },
    {
        "if": "{$ready_next_notify}",
        "$class": "atm_event",
        "$method": "is_good",
        "eventId": "{$job.data.id}",
        "$set": "failure_fixed",
        "$empty": "failure_not_fixed"
    },
    {
        "if": "{$failure_fixed}",
        "$class": "util",
        "$method": "set",
        "base":"{$alarm}",
        "name":"fixed",
        "value":"{$failure_fixed}",
        "$set": "notification_status"
    },
    {
        "if": "{$failure_not_fixed}",
        "$class": "util",
        "$method": "set",
        "base":"{$alarm}",
        "name":"not_fixed",
        "value":"{$failure_not_fixed}",
        "$set": "notification_status"
    },
    {
        "if": ["{$notification_status.answered}", "{$notification_status.fixed}"],
        "$class": "atm_event",
        "$method": "update",
        "eventId": "{$job.data.id}",
        "state": "Alarm failed",
        "status": "fixed"
    },
    {
        "if": ["{$notification_status.answered}", "{$notification_status.not_fixed}"],
        "$class": "atm_event",
        "$method": "update",
        "eventId": "{$job.data.id}",
        "state": "Alarm failed",
        "status": "fix failed"
    }
]